services:
  tf2-sapi4:
    image: tf2-sapi4:latest
    build: .
    container_name: tf2-sapi4
    environment:
      PULSE_SERVER: unix:/run/user/${UID}/pulse/native
    volumes:
      # Files cannot be replaced, only modified. Otherwise Docker loses track of them.
      # Make sure "console.log" exists before starting the container,
      # otherwise Docker will create a directory with that name on the host
      - /run/user/${UID}/pulse/native:/run/user/${UID}/pulse/native:ro
      - ${HOME}/.steam/steam/steamapps/common/Team Fortress 2/tf/console.log:/tts/console.log:ro
      - ./chat_to_speech.sh:/tts/chat_to_speech.sh:ro
      - ./get_sapi4_voice.sh:/tts/get_sapi4_voice.sh:ro
    devices:
      - /dev/snd:/dev/snd
    ports:
      - "5491:5491"
    restart: unless-stopped
    security_opt:
      - "no-new-privileges=true"
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
      - SETUID
      - SETGID
      - CHOWN
      - DAC_OVERRIDE
    tmpfs:
      - /tmp
